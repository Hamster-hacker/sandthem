<div class="container my-4">
  <div class="row">
    <div style="width: 450px;">
      <img
      src="<%= @dream.photo.attached? ? cl_image_path(@dream.photo.key) : asset_path(@dream.image_url) %>"
      alt="<%= @dream.title %>"
      class="img-fluid rounded">
    </div>

    <div class="col-lg-6">
      <div class="d-flex">
        <h2 class="text-primary"><%= @dream.title %></h2>
        <% if @average_rating > 0 %>
          <p class="ms-3">
            <strong>Rating:</strong>
            <span class="badge bg-primary"><%= '%.1f' % @average_rating %> / 5.0</span>
          </p>
        <% end %>
      </div>
      <p><%= @dream.description %></p>
      <p><strong>Category:</strong> <%= @dream.category %></p>
      <p class="mt-3">
        <strong>Price:</strong>
        <%= number_to_currency(@dream.price, unit: "â‚¬") %>
      </p>
      <p>
        <% hours = @dream.duration / 60 %>
        <% minutes = @dream.duration % 60 %>
        <% if @dream.duration > 60 %>
          <strong>Duration:</strong> <%= "#{pluralize(hours, 'hour')} #{pluralize(minutes, 'minute')}" %>
        <% elsif @dream.duration < 60 %>
          <strong>Duration:</strong> <%= pluralize(@dream.duration, "minute") %>
        <% else %>
          <strong>Duration:</strong> <%= "#{pluralize(hours, 'hour')}" %>
        <% end %>
      </p>
    </div>
  </div>

  <div class="row mt-5">
    <div class="col-lg-6">
      <% if current_user && @dream.bookings.exists?(user_id: current_user.id) && @user_review.nil? %>
        <%= link_to new_dream_review_path(@dream), class: "btn btn-outline-primary btn-sm", title: "Add a Review" do %>
          <i class="fas fa-pen"></i> Add a Review
        <% end %>
      <% elsif !@user_review.nil? %>
        <div class="card shadow-sm border-0 mb-4">
          <div class="card-body">
            <h6 class="fw-bold text-primary"><%= @user_review.title %></h6>
            <span class="text-muted"><%= time_ago_in_words(@user_review.created_at) %> ago</span>
            <p class="text-muted"><%= @user_review.description %></p>
            <div>
              <% @user_review.rating.to_i.times do %>
                <i class="fas fa-star text-warning"></i>
              <% end %>
              <% (5 - @user_review.rating.to_i).times do %>
                <i class="far fa-star text-warning"></i>
              <% end %>
              <span class="text-muted ms-2">(<%= (@user_review.rating.to_f).round(1) %> / 5.0)</span>
            </div>
            <%= link_to edit_dream_review_path(@dream, @user_review), class: "btn btn-warning btn-sm mt-2" do %>
              <i class="fas fa-edit"></i> Edit Review
            <% end %>
            <%= link_to dream_review_path(@dream, @user_review),
                        data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete your review?" },
                        class: "btn btn-danger btn-sm mt-2 ms-2" do %>
              <i class="fas fa-trash-alt"></i> Delete Review
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <div class="col-lg-6 d-flex flex-column align-items-end">
      <% if !@dream.is_owner?(current_user) %>
        <%= render "booking", dream: @dream, booking: @booking %>
      <% end %>
    </div>
  </div>

  <div class="d-flex justify-content-between mt-4">
    <%= link_to "Back to HomePage", dreams_path, class: "btn btn-primary" %>
    <% if @dream.is_owner?(current_user) %>
      <div>
        <%= link_to dream_path(@dream),
                    data: { turbo_method: :delete, turbo_confirm: "Are you sure?" },
                    class: "btn btn-danger me-2",
                    title: "Delete Dream" do %>
          <i class="fas fa-trash-alt"></i> Delete
        <% end %>
        <%= link_to edit_dream_path(@dream),
                    class: "btn btn-warning",
                    title: "Edit dream" do %>
          <i class="fas fa-edit"></i> Edit
        <% end %>
      </div>
    <% end %>
  </div>
</div>
