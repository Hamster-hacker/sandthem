<div class="container my-4">
  <div class="row">
    <div class="col-lg-6">
      <h2 class="text-primary"><%= @dream.title %></h2>
      <p><%= @dream.description %></p>
      <p><strong>Category:</strong> <%= @dream.category %></p>
      <img src="<%= @dream.image_url %>" alt="<%= @dream.title %>" class="img-fluid rounded" style="max-width: 300px;">
      <p class="mt-3">
        <strong>Price:</strong>
        <%= number_to_currency(@dream.price, unit: "â‚¬") %>
      </p>
      <p>
        <% hours = @dream.duration / 60 %>
        <% minutes = @dream.duration % 60 %>
        <% if @dream.duration > 60 %>
          <strong>Duration:</strong> <%= "#{pluralize(hours, 'hour')} #{pluralize(minutes, 'minute')}" %>
        <% elsif @dream.duration < 60 %>
          <strong>Duration:</strong> <%= pluralize(@dream.duration, "minute") %>
        <% else %>
          <strong>Duration:</strong> <%= "#{pluralize(hours, 'hour')}" %>
        <% end %>
      </p>
      <% if @average_rating > 0 %>
        <p>
          <strong>Rating:</strong>
          <span class="badge bg-primary"><%= '%.1f' % @average_rating %> / 5.0</span>
        </p>
      <% end %>

<% if current_user && @dream.bookings.exists?(user_id: current_user.id) && @user_review.nil? %>
  <div class="mt-3">
    <%= link_to new_dream_review_path(@dream), class: "btn btn-outline-primary btn-sm", title: "Add a Review" do %>
      <i class="fas fa-pen"></i> Add a Review
    <% end %>
  </div>
<% elsif !@user_review.nil? %>
  <div class="card mt-4 shadow-sm" style="max-width: 400px; border: 4px solid var(--bs-primary);">

  <div class="card-body">
    <h6 class="fw-bold mb-2"><%= @user_review.title %></h6>
    <span class="text-muted ms-auto"><%= time_ago_in_words(@user_review.created_at) %> ago</span>

    <p class="text-muted mb-3"><%= @user_review.description %></p>
    <div>
      <% @user_review.rating.to_i.times do %>
        <i class="fas fa-star text-warning"></i>
      <% end %>
      <% (5 - @user_review.rating.to_i).times do %>
        <i class="far fa-star text-warning"></i>
      <% end %>
      <span class="text-muted ms-2">(<%= (@user_review.rating.to_f).round(1) %> / 5.0)</span>
    </div>
  </div>
</div>
<% end %>

<% if @reviews.any? %>
  <% @reviews.each do |review| %>
    <div class="card mt-4 shadow-sm border-0" style="max-width: 400px;">
      <div class="card-body">
        <h6 class="fw-bold text-primary mb-2"><%= review.title %></h6>
        <span class="text-muted ms-auto"><%= time_ago_in_words(review.created_at) %> ago</span>

        <p class="text-muted mb-3"><%= review.description %></p>
        <div>
          <% review.rating.to_i.times do %>
            <i class="fas fa-star text-warning"></i>
          <% end %>
          <% (5 - review.rating.to_i).times do %>
            <i class="far fa-star text-warning"></i>
          <% end %>
          <span class="text-muted ms-2">(<%= review.rating %> / 5.0)</span>
        </div>
        <p><em>by: <%= review.user.username %></em></p>
      </div>
    </div>
  <% end %>
<% end %>


    </div>

    <div class="col-lg-6">
      <% if !@dream.is_owner?(current_user) %>
        <%= render "booking", dream: @dream, booking: @booking %>
      <% end %>
    </div>
  </div>

  <div class="d-flex justify-content-between mt-4">
    <%= link_to "Back to HomePage", dreams_path, class: "btn btn-primary" %>

    <% if @dream.is_owner?(current_user) %>
      <div>
        <%= link_to dream_path(@dream),
                    data: { turbo_method: :delete, turbo_confirm: "Are you sure?" },
                    class: "btn btn-danger me-2",
                    title: "Delete Dream" do %>
          <i class="fas fa-trash-alt"></i> Delete
        <% end %>
        <%= link_to edit_dream_path(@dream),
                    class: "btn btn-warning",
                    title: "Edit dream" do %>
          <i class="fas fa-edit"></i> Edit
        <% end %>
      </div>
    <% end %>
  </div>
</div>
